{% extends "base.html" %}

{% block content %}
<div class="main">
    <center>
        <form class="form-container" method="post">
            {{ form.hidden_tag()}}
            <div class="box">
                <table>
                    <caption>
                        <h1 style="color: red;">Modifica giro</h1>
                    </caption>

                    <tr>
                        <td>{{ form.tripname.label }}</td>
                        <td>{{ form.tripname() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.speed.label }}</td>
                        <td>{{ form.speed() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.distance.label }}</td>
                        <td>{{ form.distance() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.elevation.label }}</td>
                        <td>{{ form.elevation() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.recorded_on.label }}</td>
                        <td>{{ form.recorded_on() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.team.label }}</td>
                        <td>{{ form.team(class_="form-control") }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.n_of_partecipants.label }}</td>
                        <td>{{ form.n_of_partecipants() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.prestige.label }}</td>
                        <td>
                            <div class="prestige-label-container">
                                {% for subfield in form.prestige %}
                                <label class="prestige-label">
                                    {{ subfield }}
                                    <span>{{ subfield.label() }}</span>
                                </label><br>
                                {% endfor %}
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>{{ form.description.label }}</td>
                        <td>{{ form.description(size=20, rows=5) }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.n_of_placements.label }}</td>
                        <td>
                            <div id="placement-entries">
                                {% for placement in placements %}
                                <div>
                                    <input type="hidden" name="placement_id" value="{{ placement.id }}">
                                    <label for="edit_placement">Placement {{loop.index }}:</label>
                                    <select name="edit_placement">
                                        {% for position in range(1, 11) %}
                                        <option value="{{ position }}" {% if placement.place==position %}selected{%
                                            endif %}>{{ position }}&#186;</option>
                                        {% endfor %}
                                    </select>
                                    <button type="button" class="delete-button">Delete</button>
                                </div>
                                {% endfor %}
                            </div>
                            <button id="add-placement-button">Aggiungi piazzamento</button>
                        </td>

                    </tr>
                    <tr>
                        <td colspan="2" style="text-align: center;">{{ form.submit_save }}</td>
                    </tr>
                </table>
                <footer>
                    <button>
                        <a class="delete-button" style="align-items:center; color:black;"
                            href="{{ url_for('delete_trip', trip_id=trip_id, user_id=user_id) }}">Elimina</a>
                    </button>
                </footer>
            </div>
        </form>
    </center>
    <div class="left-sidebar"></div>
    <div class="right-sidebar"></div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var placementEntriesContainer = document.getElementById("placement-entries");

        // Function to update the placement numeration
        function updatePlacementNumeration() {
            var placementLabels = placementEntriesContainer.getElementsByTagName("label");

            for (var i = 0; i < placementLabels.length; i++) {
                placementLabels[i].textContent = "Placement " + (i + 1) + ": ";
            }
        }

        // Add event listener to "Add Placement" button
        document.getElementById("add-placement-button").addEventListener("click", function (event) {
            event.preventDefault(); // Prevent the button from triggering a form submission

            var label = document.createElement("label");
            label.textContent = "Placement " + (placementEntriesContainer.childElementCount + 1) + ": ";

            var select = document.createElement("select");
            select.name = "placement[]";

            // Add options with values 1 to 10
            for (var j = 1; j <= 10; j++) {
                var option = document.createElement("option");
                option.value = j;
                option.text = j + "\u00BA";
                select.appendChild(option);
            }

            var deleteButton = document.createElement("button");
            deleteButton.textContent = "Delete";
            deleteButton.className = "delete-button";
            deleteButton.style.marginLeft = "4px";


            deleteButton.addEventListener("click", function () {
                this.parentNode.remove(); // Remove the parent div when delete button is clicked
                updatePlacementNumeration(); // Update the placement numeration
            });

            var div = document.createElement("div");
            div.appendChild(label);
            div.appendChild(select);
            div.appendChild(deleteButton);

            placementEntriesContainer.appendChild(div);
        });

        // Add event listener to delete buttons
        placementEntriesContainer.addEventListener("click", function (event) {
            if (event.target.classList.contains("delete-button")) {
                event.target.parentNode.remove(); // Remove the parent div when delete button is clicked
                updatePlacementNumeration(); // Update the placement numeration
            }
        });

        // Initial placement numeration update
        updatePlacementNumeration();
    });

</script>

{% endblock %}